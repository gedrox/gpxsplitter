<!doctype html>
<html dl>
<head>
<title>Strava Split</title>
<style>
</style>
</head>
<body>
<h1>Strava Split</h1>

<p>Upload a .gpx file</p>
<form>
<input type="file"> <!-- multiple="multiple" accept="image/jpg, ..." -->
</form>

<!-- Use Downloadify for the result files -->

<script src="jquery.min.js"></script>
<script type="text/javascript">
$(function(){
  // Check for the various File API support.
  if (window.File && window.FileReader && window.FileList && window.Blob) {
    // Great success! All the File APIs are supported.
  } else {
    console.error('The File APIs are not fully supported in this browser.');
  }

  // gpx type seems to be `application/gpx+xml`

  $("input[type='file']").change(function(e){
    // uploading stuff based on http://www.html5rocks.com/en/tutorials/file/dndfiles/
    var gpxFile = e.target.files[0]
    // TODO listen to 'drop' event.  `e.dataTransfer.files` and `e.dataTransfer.dropEffect = 'copy'`
    console.log(gpxFile.name)

    var reader = new FileReader()
    reader.onload = function(e) {
      var xmlString = e.target.result

      // based on http://stackoverflow.com/questions/17604071/parse-xml-using-javascript
      var parser = new DOMParser()
      var xml = parser.parseFromString(xmlString, 'text/xml')
      var xml2 = parser.parseFromString(xmlString, 'text/xml') // TODO clone instead

      // Split the "gpx trk trkseg" into multiple parts
      var trkpts = xml2.getElementsByTagName('trkpt')
      console.debug(trkpts)

      // TODO iterate through trkpts, remove some of them.

      trkpts[0].remove()

    }
    reader.readAsText(gpxFile)
  })

})
</script>
</body>
</html>
